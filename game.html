<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="css/characters.css">
    <script type="text/javascript" src="vendor/jquery/jquery.js"></script>
    <script type="text/javascript" src="vendor/bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" src="js/characters.js"></script>
</head>
<body class="fullscreen">
    <section class="">
        <div class="container">
            <div class="start-game">
                <div class="btn btn-success btn-lg">Start</div>
            </div>
            <div id="stage">
            </div>
            <div class="lvl-btns">
                <a href="#" class="btn btn-success btn-lg" onclick="level1();">level1</a>
                <a href="#" class="btn btn-success btn-lg" onclick="level2();">level2</a>
                <a href="#" class="btn btn-success btn-lg" onclick="level3();">level3</a>
                <a href="#" class="btn btn-success btn-lg" onclick="level4();">level4</a>
            </div>  
        </div>
    </section>
    <script type="text/javascript">
        var stage, intervalId;
        function level1(){
            stage.reload();
            clearInterval(intervalId);
            key = new Key(stage);
            luke = new Luke({});
            luke.registerKeys();
            stage.addCharacter(luke);
            door = new Door(stage);
            sword = new Sword(stage);
            intervalId=setInterval(function(){
                luke.updatePosition();

                if (compare(luke.jqEl.offset(), door.jqEl.offset())) {
                    if (stage.rightBar.keyExist('keyVal')){
                        door.open();
                        setTimeout(function(){
                            level2();
                        }, 1500); 
                    }             
                }
                if (compare(luke.jqEl.offset(), sword.jqEl.offset())) {
                    stage.rightBar.addItem('sword');
                    sword.jqEl.remove();
                }
                if (compare(luke.jqEl.offset(), key.jqEl.offset())) {
                    stage.rightBar.addItem('keyVal');
                    key.jqEl.remove();
                }
            },50);
        };
        function level2(){
            clearInterval(intervalId);
            stage.reload();
            key = new Key(stage);
            luke = new Luke({});
            luke.registerKeys();
            stage.addCharacter(luke);
            door = new Door(stage);
            intervalId = setInterval(function(){
                luke.updatePosition();
                if (compare(luke.jqEl.offset(), door.jqEl.offset())) {
                 level3();
             }
             if (compare(luke.jqEl.offset(), key.jqEl.offset())) {
                stage.rightBar.addItem('keyVal');
                key.jqEl.remove();
            }
        },50);
        };
        function level3(){
            clearInterval(intervalId);
            stage.reload();
            hero = new Luke({posX:200, posY:300}),
            keyObj = new Key(stage, {posX:500, posY:200})
            door = new Door(stage, {posX:800, posY:200})
            darkLord = new Darklord({posX: 700, posY:200});
            stage.addCharacter(hero);
            stage.addPerson(darkLord);
            hero.jqEl.css('height', '150px');
            darkLord.jqEl.css('height', '160px');
            keyObj.jqEl.css('width', '75px');
            keyObj.jqEl.css('background-size', '100%');
            door.jqEl.css('width', '100px');
            door.jqEl.css('background-size', '100%');
            darkLord.startVetricalAnimation({topY: 50, bottomY:450});
            hero.registerKeys();   
            setInterval(function(){
                hero.updatePosition();
                darkLord.updatePosition();
                if (compare(hero.jqEl.offset(), keyObj.jqEl.offset())){
                    stage.rightBar.addItem('keyVal');
                    keyObj.jqEl.remove();
                }
                if (compare(hero.jqEl.offset(),darkLord.jqEl.offset())) {
                    hero.posX = 50;
                    hero.posY = 200;
                    alert('Потрачено')
                }
                if (compare(hero.jqEl.offset(), door.jqEl.offset())){
                    if (stage.rightBar.keyExist('keyVal')) {
                        door.open();
                        location='game.html';
                    }
                }
            },10);
        }
        function level4(){
            clearInterval(intervalId);
            stage.reload();
            intervalId = setInterval(function(){
                shooter.updatePosition();
            }, 50)
            var shooter = new Shooter({posX: 100, posY:250}); 
            stage.addPerson(shooter);
            shooter.registerKeys();

        }
        $( document ).ready(function() {
            stage= new Stage('stage');
            

            $('.start-game .btn').on('click', function(){
                level1();
                $(this).remove()
            });
        });      
    </script>
</body>
</html>